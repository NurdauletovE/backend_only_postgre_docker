#!/bin/bash
# CIS Benchmark Remediation Script
# Generated by CIS Benchmark Scanner
# Date: 2025-07-18T23:22:55.007865

echo 'Starting CIS Benchmark Remediation...'

# 1 1 Filesystem Configuration
echo 'Fixing: Ensure mounting of cramfs filesystems is disabled'
echo "install cramfs /bin/true" >> /etc/modprobe.d/cramfs.conf

echo 'Fixing: Ensure mounting of freevxfs filesystems is disabled'
echo "install freevxfs /bin/true" >> /etc/modprobe.d/freevxfs.conf

echo 'Fixing: Ensure mounting of jffs2 filesystems is disabled'
echo "install jffs2 /bin/true" >> /etc/modprobe.d/jffs2.conf

echo 'Fixing: Ensure mounting of hfs filesystems is disabled'
echo "install hfs /bin/true" >> /etc/modprobe.d/hfs.conf

echo 'Fixing: Ensure mounting of hfsplus filesystems is disabled'
echo "install hfsplus /bin/true" >> /etc/modprobe.d/hfsplus.conf

echo 'Fixing: Ensure mounting of squashfs filesystems is disabled'
echo "install squashfs /bin/true" >> /etc/modprobe.d/squashfs.conf

echo 'Fixing: Ensure mounting of udf filesystems is disabled'
echo "install udf /bin/true" >> /etc/modprobe.d/udf.conf

echo 'Fixing: Ensure /tmp is configured as separate partition'
Configure /tmp as separate partition or tmpfs

# 1 2 Software Updates
# 1 3 Filesystem Integrity
echo 'Fixing: Ensure AIDE is installed'
apt install aide aide-common

# 1 4 Secure Boot
echo 'Fixing: Ensure permissions on /boot/grub/grub.cfg are configured'
chown root:root /boot/grub/grub.cfg; chmod 400 /boot/grub/grub.cfg

echo 'Fixing: Ensure bootloader password is set'
Configure GRUB password in /etc/grub.d/40_custom

# 3 X Network Configuration
echo 'Fixing: Ensure dccp is disabled'
echo "install dccp /bin/true" >> /etc/modprobe.d/dccp.conf

echo 'Fixing: Ensure sctp is disabled'
echo "install sctp /bin/true" >> /etc/modprobe.d/sctp.conf

echo 'Fixing: Ensure rds is disabled'
echo "install rds /bin/true" >> /etc/modprobe.d/rds.conf

echo 'Fixing: Ensure tipc is disabled'
echo "install tipc /bin/true" >> /etc/modprobe.d/tipc.conf

echo 'Fixing: Ensure net.ipv4.conf.default.accept_source_route is set to 0'
sysctl -w net.ipv4.conf.default.accept_source_route=0

echo 'Fixing: Ensure net.ipv6.conf.all.accept_ra is set to 0'
sysctl -w net.ipv6.conf.all.accept_ra=0

echo 'Fixing: Ensure net.ipv6.conf.default.accept_ra is set to 0'
sysctl -w net.ipv6.conf.default.accept_ra=0

# 4 X Logging And Auditing
echo 'Fixing: Ensure auditing is enabled'
systemctl enable auditd

# 5 X Access Control
echo 'Fixing: Ensure permissions on /etc/crontab are configured'
chown root:root /etc/crontab; chmod 600 /etc/crontab

echo 'Fixing: Ensure permissions on /etc/ssh/sshd_config are configured'
chown root:root /etc/ssh/sshd_config; chmod 600 /etc/ssh/sshd_config

# 5 X Authentication
echo 'Fixing: Ensure password creation requirements are configured'
Configure password complexity in /etc/security/pwquality.conf

echo 'Fixing: Ensure lockout for failed password attempts is configured'
Configure pam_faillock in PAM configuration

echo 'Fixing: Ensure password reuse is limited'
Configure password history in /etc/pam.d/common-password

# 6 X System Maintenance
echo 'Fixing: Audit system file permissions for /etc/shadow'
chown root:root /etc/shadow; chmod 0o640 /etc/shadow

echo 'Fixing: Audit system file permissions for /etc/gshadow'
chown root:root /etc/gshadow; chmod 0o640 /etc/gshadow

echo 'Fixing: Ensure no world writable files exist'
Review and fix permissions on world writable files

echo 'Fixing: Ensure no unowned files or directories exist'
Review and assign ownership to unowned files

echo 'CIS Benchmark Remediation Complete'
echo 'Please review changes and reboot if necessary'
